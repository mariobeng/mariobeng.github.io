<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
    <title>矿力排行</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" href="css/scroll/mescroll.min.css">
    <style type="text/css">
        html {
            /* padding: 45px 0 0; */
            background-color: #2A2A2A;
            color: #fff;
        }

        .in_record {
            width: 95%;
            background-color: #2F2F2F;
        }

        .in_record ul li {
            padding: 10px 1.5%;
        }

        .in_record ul li .head {
            float: left;
            margin-left: 3%;
        }

        .in_record ul li .head img {
            display: block;
            width: 50px;
            height: 50px;
            border-radius: 100%;
        }

        .in_record p {
            line-height: 50px;
            font-size: 1rem;
        }

        .in_record p.myname {
            float: left;
            margin-left: 3%;
        }

        .in_record p.myrank {
            float: right;
            color: #FBC85F;
        }

        .mescroll {
            position: fixed;
            top: 263px;
            left: 2.5%;
            height: 58%;
        }


        .blue {
            color: #0010a5;
        }
    </style>
</head>

<body>
    <div class="threeBox">
        <ul class="clearfix">
            <li class="no_s">
                <img class="hat" src="images/second_hat.png">
                <div class="head">
                    <img class="headImg" src="images/head.jpg" alt="">
                </div>
                <h5 class="userName">用户名</h5>
                <p>矿力</p>
                <p class="rankNum">0</p>
            </li>
            <li class="no_f">
                <img class="hat" src="images/first_hat.png">
                <div class="head">
                    <img class="headImg" src="images/head.jpg" alt="">
                </div>
                <h5 class="userName">用户名</h5>
                <p>矿力</p>
                <p class="rankNum">0</p>
            </li>
            <li class="no_t">
                <img class="hat" src="images/third_hat.png">
                <div class="head">
                    <img class="headImg" src="images/head.jpg" alt="">
                </div>
                <h5 class="userName">用户名</h5>
                <p>矿力</p>
                <p class="rankNum">0</p>
            </li>
        </ul>
    </div>
    <div class="myself clearfix">
        <div class="hexagon">
            <div class="bar-rotate-left">
                <div class="bar-rotate-right">
                    <div id="rankNo" class="bar-horizontal">0</div>
                </div>
            </div>
        </div>
        <div class="head">
            <img class="headImg" src="images/head.jpg" alt="">
        </div>
        <p class="myname">我自己</p>
        <p class="myrank">0</p>
    </div>
    <div id="fu_mescroll">
        <div id="mescroll" class="in_record mescroll">
            <div>
                <ul></ul>
            </div>
        </div>
    </div>
    <script src="js/scroll/mescroll.min.js" charset="utf-8"></script>
    <script src="js/jquery-1.10.1.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/url.js"></script>
    <script type="text/javascript" src="js/getUrlParam.js"></script>
    <script type="text/javascript">
        var uid = getUrlParam("uid");
        topThree();
        getMyself();

        function getMyself() {
            $.ajax({
                url: url + "/mineral/rank/my",
                type: "post",
                dataType: "json",
                data: {
                    uid: uid
                },
                success: function(res) {
                    console.log(res);
                    if (res.data.icon == "") {

                    } else {
                        $(".myself").find("img.headImg").attr("src", res.data.icon)
                    }
                    $("#rankNo").html(res.data.rank)
                        //$(".myself").find(".myname").html(res.data.userName)
                    $(".myself").find(".myrank").html(res.data.mineralPow)
                },
                error: function(e) {
                    mescroll.endErr();
                }
            });
        }

        function topThree() {
            $.ajax({
                url: url + "/mineral/top/three",
                type: "post",
                dataType: "json",
                data: {
                    pageNum: 1
                },
                success: function(res) {
                    console.log(res);
                    if (res.data[1].icon == "") {
                        //console.log("");
                    } else {
                        $("li.no_s").find("img.headImg").attr("src", res.data[1].icon);
                    };
                    if (res.data[2].icon == "") {
                        //console.log("");
                    } else {
                        $("li.no_t").find("img.headImg").attr("src", res.data[2].icon);
                    };
                    if (res.data[0].icon == "") {
                        //console.log("");
                    } else {
                        $("li.no_f").find("img.headImg").attr("src", res.data[0].icon);
                    };
                    $("li.no_f").find("h5.userName").html(res.data[0].userName);
                    $("li.no_f").find("p.rankNum").html(res.data[0].mineralPow);
                    $("li.no_s").find("h5.userName").html(res.data[1].userName);
                    $("li.no_s").find("p.rankNum").html(res.data[1].mineralPow);
                    $("li.no_t").find("h5.userName").html(res.data[2].userName);
                    $("li.no_t").find("p.rankNum").html(res.data[2].mineralPow);
                },
                error: function(xhr) {
                    console.log(xhr)
                }
            });
        }
        var mescroll = new MeScroll("mescroll", {
            down: {
                use: false, // 是否启用下拉刷新
                auto: false //是否在初始化完毕之后自动执行下拉回调callback; 默认true
            },
            up: {
                callback: upCallback,
                page: {
                    num: 0,
                    size: 7
                },
                noMoreSize: 5,
                empty: {
                    //列表第一页无任何数据时,显示的空提示布局; 需配置warpId才显示
                    warpId: "fu_mescroll", //父布局的id (1.3.5版本支持传入dom元素)
                    icon: "images/mescroll-empty.png", //图标,默认null,支持网络图
                    tip: "暂无相关数据~" //提示
                }
            }
        });

        function upCallback(page) {
            $.ajax({
                url: url + "/mineral/rank",
                type: "post",
                dataType: "json",
                data: {
                    pageNum: page.num
                },
                success: function(res) {
                    console.log("111");
                    console.log(res);
                    //方法一(推荐): 后台接口有返回列表的总页数 totalPage
                    //必传参数(当前页的数据个数, 总页数)
                    mescroll.endByPage(7, 3);
                    //设置列表数据
                    for (var i = 0; i < res.data.length; i++) {
                        if(res.data[i].icon == ""){
                            $(".in_record ul").append(`<li class="clearfix">
                                <div class="hexagon">
                                    <div class="bar-rotate-left">
                                        <div class="bar-rotate-right">
                                            <div class="bar-horizontal">` + res.data[i].rank + `</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="head"><img class="headImg" src="images/head.jpg" alt=""></div>
                                <p class="myname">` + res.data[i].userName + `</p>
                                <p class="myrank">` + res.data[i].mineralPow + `</p>
                            </li>`);
                        }else{
                            $(".in_record ul").append(`<li class="clearfix">
                                <div class="hexagon">
                                    <div class="bar-rotate-left">
                                        <div class="bar-rotate-right">
                                            <div class="bar-horizontal">` + res.data[i].rank + `</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="head"><img class="headImg" src="` + res.data[i].icon + `" alt=""></div>
                                <p class="myname">` + res.data[i].userName + `</p>
                                <p class="myrank">` + res.data[i].mineralPow + `</p>
                            </li>`);
                        }

                    }
                },
                error: function(e) {
                    mescroll.endErr();
                }
            });
        }
    </script>
</body>

</html>
